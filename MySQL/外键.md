数据库外键

[解读阿里开发规范：为何阿里禁止使用外键，看完有被恶心到！！！_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1im421E7vV/?spm_id_from=333.337.search-card.all.click&vd_source=c7ebf7408123ab5de1032a62a32045bd)

[【大厂面试题】为什么大厂不让用外键？_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1EF411w7Qy/?spm_id_from=333.337.search-card.all.click&vd_source=c7ebf7408123ab5de1032a62a32045bd)

感觉第二个视频更好。

github.com/alibaba/p3c

[为什么说PostgreSQL是数据库天花板？它为何这么全能？_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1gxsnzWEBy?spm_id_from=333.788.recommend_more_video.4&trackid=web_related_0.router-related-2481894-52kq4.1770723683758.723&vd_source=c7ebf7408123ab5de1032a62a32045bd)

讲得挺好吧。



[对比四款主流关系型数据库_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1SB4y1k7bV/?spm_id_from=333.337.search-card.all.click&vd_source=c7ebf7408123ab5de1032a62a32045bd)

数据库。



简单说一下我目前的情况

首先就是，这东西好像确实对于windows支持不是很好，虽然我也有WSL。但是大家都推荐Mac，
哎，长这么大，就没有用过Mac。

我还有一个Linux的云服务器，但是，问题是，我好像没有给这个云服务器弄桌面……

其次就是软件方面，貌似好像只能弄飞书。不过我也下载了飞书。

另外，我看了一下它的实现，
貌似就是对AI暴露你的所有权限，
操作上貌似还是通过命令行的方式。

换言之，
它其实就是Claude Code的升级版，
加上了一些操作通讯工具的提示词。

有一点麻烦。
最近还正好在学第三方应用使用Token鉴权这一块的内容，
总之，
我感觉吧，这样对AI非常信任暴露自己的权限，
可能确实还是有一点太「先进」了。

不过，
我还是先通过WSL试一下吧。



[千疮百孔的世界上最流行的数据库【让编程再次伟大#番外1】_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1BAABeKEqp?spm_id_from=333.788.videopod.sections&vd_source=c7ebf7408123ab5de1032a62a32045bd)

里面提到一些MySQL的bug，就比如说，它的trigger会很莫名其妙。有时候无法出发
还有，就是它的enum枚举的排序逻辑诡异。
还有一些index的副作用。
MySQL可能不会自己去选择最好的index，
等一下，
这个bug后来不是被修复了吗？

[有些数据库是蠢，有些是坏，它是又蠢又坏【让编程再次伟大#番外2】_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1M1Koz6EW1?spm_id_from=333.788.videopod.sections&vd_source=c7ebf7408123ab5de1032a62a32045bd)

另外，还要foreign key，
修改foreign key的时候，会锁表。
但是，MySQL可能会格外上锁，在index的时候。

另外，
MySQL的事务无法让DDL回滚，
只能让DML回滚。

MySQL还是比较逆天的。
MySQL又蠢又坏。

[全网最尊重MySQL的博主_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV12We7z8EZR?spm_id_from=333.788.videopod.sections&vd_source=c7ebf7408123ab5de1032a62a32045bd)

我感觉，
要是年后有机会的话，
就去迁移一下吧。





## 语法

如何建立外键？MySQL和PostgreSQL在这一点上面有什么区别
外键有什么用？
外键是否会影响性能呢？

另外，
我在重构自己的数据库，
我想问一下，
我是否需要在每一个建表语句之前都写一个DROP TABLE IF EXISTS 
另外，我想要从MySQL迁移到PostgreSQL，有什么注意事项吗？



感觉找外键的依赖关系好复杂啊，就没有那种直接清空数据库的命令吗？
另外，我还想知道，我的业务逻辑能不能直接在数据库层面实现呢？
如果在数据库层面实现，
那么业务层面是否还需要去实现逻辑呢？
万一两个地方重复了怎么办呢？
所以，
数据库适合实现怎样的业务逻辑？
就比如说，
设置创建时间和更新时间的自动逻辑？

[千问](https://www.qianwen.com/share/chat/38fbb9941f2a44f0bc5e40f4d7413cb6)
有一说一，我感觉回答得还可以。



还有一个小问题，

我感觉ID作为主键都不需要comment “id”，我们直接PRIMAY KEY就可以了，但是，我见到的语句当中，它都是单独一行写PRIMARY KEY (id)，我能不能把它们全部替换一下。



你刚才提到外键必须要唯一，
我现在有一个问题，我数据库表当中存着一个MD5数据，但是我看他的建表语句当中，
它和buckname合起来构成一个唯一索引，
然而，
我看这个buckname的，它是MinIO的配置，在生成环境和开发环境是不一样的，
所以，我感觉生成环境下，
可以使用MD5作为唯一索引，
为什么MinIO需要buckname啊
是否后面会出现确实需要联合唯一索引的情况呢？
我能不能修改呢？

---

不是……
我现在也觉得很诡异，
实际上，
我们的开发环境下根本就没有数据，
我们开发环境的数据库也是本地的测试数据库，
所以，
根本就不会和线上的数据库碰撞，
上线的时候，
我们也会自己去更换一个buckname。

更重要的是，
我们的数据库表当中，
和origin file关联的文件表当中，根本就没有buckname这个字段……
效果就是，

我们线上删除文件，
只会删除配置当中写的那个buckname里面的文件。
快点评一下，
这样设计的用意到底是什么？
难道，
我应该也给我们的文件关联的表添加一个buckname？